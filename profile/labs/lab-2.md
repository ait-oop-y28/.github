# Лабораторная 2

# Отрабатываемый материал

Основные принципы ООП, GRASP, SOLID, структурные паттерны, mocking.

# Цель

Отработать реализацию структурных паттернов, применить их совместно с ранее изученным материалом.

# Задание

- Реализовать объектную модель корпоративной системы распределения сообщений, используя на практике отрабатываемый
  теоретический материал
- Покрыть полученное решение функциональными авто-тестами

# Формулировка

Некоторая компания разрабатывает корпоративную систему распределения сообщений. Предметная область, которую компания
автоматизирует, имеет сложный механизм формирования адресатов, а так же набор различных конечных точек для сообщений.

# Функциональные требования

## Сообщение

- Имеет заголовок
- Имеет тело
- Имеет уровень важности

## Форматтер сообщений

Позволяет записать сообщения покомпонентно, отдельно заголовок, отдельно тело. Существует два вида форматтеров:
файловый, консольный.

Форматтер должен записывать сообщения, используя Markdown синтаксис.

## Архиватор сообщений

Сервис сохранения сообщений.

### Форматирирующий архиватор

Принимает сообщения, сохраняет их в форматированном виде, используя форматтер.
Форматирующий арихватор не должен заявзываться на конкретный тип форматтера.

### In-memory архиватор

Сохраняет все полученные сообщения в коллекцию в памяти.

## Система оповещений

Сервис, который может реализовывать какие-либо оповещения. Существует два вида систем оповещений:

- Текстовая (выводит в консоль предварительно заданное сообщение, при вызове уведомления)
- Звуковая (выводит в консоль звуковое уведомление при помощи метода `Console.Beep()`)

## Пользователь

- Является конечной точкой сообщения
- Пользователь может иметь некоторые атрибуты (не обязательно для контекста лабораторной)
- Должна быть возможность отправить пользователю сообщение
- Пользователь должен отслеживать полученные сообщения, и их статус (прочитано, не прочитано) (статус сообщения
  существует только в контексте пользователя)
- Пользователь должен иметь возможность отметить сообщение прочитанным \
  Отметить такое сообщение можно только в статусе не прочитано, попытка отметить прочитанное сообщение должна
  обрабатываться

## Топик

- Имеет название
- Имеет адресатов
- В топик можно отправить сообщение, он должен передать его адресату

## Адресат

- В адресат можно передать сообщение
- Адресаты бывают нескольких видов
    - Адресат-пользователь
      Передает сообщение пользователю корпоративной системы
    - Адресат-архиватор
      Сохраняет сообщение в архиватор
    - Адресат-группа
      Содержит в себе несколько адресатов, передаёт каждому из них полученные сообщения
    - Адресат-система оповещений
      Проверяет наличие заранее заданных слов в сообщении и при наличии подозрительного текста – вызывает систему
      оповещений.
- Необходимо иметь возможность фильтровать сообщения для конкретных адресатов по их уровню важности
- Необходимо иметь возможность логгировать сообщения, получаемые конкретным адресатом

# Не функциональные требования

- Реализация логгирования должна быть тестируемой
  например, проверить вывод на консоль при вызове некоторых поведений в авто-тестах - невозможно \
  нужно иметь возможность реализовать в тестах mock-тип, который будет вести счётчик вызовов
- Реализация системы оповещений и архиватора должна быть тестируемой
- Реализация системы оповещений и архиватора должна быть изолирована \
  Эти реализации не должны иметь явной или неявной зависимости на логику доставки сообщений, ведь они являются
  сторонними интеграциями \
  Их реализации должны находиться в отдельных папках

# Definition of done

- Реализованы все функциональные требования
- Реализация соответствует всем не функциональным требованиям
- Реализация не нарушает принципы SOLID, следует основным принципам ООП
- Использованы структурные паттерны
- Реализованы все тест-кейсы

# Test cases

- При получении сообщения пользователем, оно сохраняется в статусе “не прочитано”
- При попытке отметить сообщение пользователя в статусе “не прочитано” как прочитанное, оно должно поменять свой статус
- При попытке отметить сообщение пользователя в статусе “прочитано” как прочитанное, должна вернуться ошибка
- При настроенном фильтре для адресата, отправленное сообщение, не подходящее под критерии важности - до адресата дойти
  не должно (в данном тесте необходимо использовать моки)
- При настроенном логгировании адресата, должен писаться лог, когда приходит сообщение (в данном тесте необходимо
  использовать моки)
- При сохранении сообщения в форматирующий архиватор, его реализаций должна вызывать ожидаемые действия (в данном тесте необходимо использовать моки)
- Добавляются два адресата-пользователя (для одного пользователя), для одного из них настраивается фильтр важности, при
  попытке отправить сообщение с важностью ниже настроенной – пользователь получает значение единожды.

---
